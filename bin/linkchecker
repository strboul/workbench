#!/usr/bin/env bash

source "$HOME"/dotfiles/zsh/utils.sh

# Crawl and parse links on a website
#
# Usage: linkchecker [WEBSITE_LINK]
#
# Sources:
# - https://github.com/linkchecker/linkchecker
# - https://wummel.github.io/linkchecker/

utils__stop_if_not_command_exists "docker"

URL=$1

[ -z "$URL" ] && utils__err_exit "provide an URL"

FOLDER_NAME="$(printf "linkchecker_%s\n" $(utils__timestamp))"

mkdir -p "$FOLDER_NAME"

docker run --rm -it           \
  -u $(id -u):$(id -g)        \
  -v $PWD/"$FOLDER_NAME":/mnt \
  linkchecker/linkchecker     \
  -Fhtml/linkchecker.html     \
  -Fcsv/linkchecker.csv       \
  --verbose                   \
  $URL


# vim: ft=sh
