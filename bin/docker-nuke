#!/usr/bin/env bash

# Clean up everything in Docker
#
# Usage:
#  docker-nuke
#
# It's also possible to remove any other container runtime (e.g., podman) as
# the commands are identical.
#  docker-nuke <command>
#

source "$HOME"/dotfiles/bin/__utils/utils.sh

COMMAND="$1"

# set default.
if [ -z "$COMMAND" ]; then
  COMMAND="docker"
fi

remove_containers() {
  utils__log__info "force removing containers"
  # shellcheck disable=SC2046 # intended splitting
  "$COMMAND" rm -f $("$COMMAND" ps -qa)
}

remove_images() {
  utils__log__info "force removing images"
  # shellcheck disable=SC2046 # intended splitting
  "$COMMAND" rmi -f $("$COMMAND" images -q)
}

remove_volumes() {
  utils__log__info "force removing volumes"
  "$COMMAND" volume prune -f
}

main() {
  remove_containers
  remove_images
  remove_volumes
}

main
