#!/usr/bin/env bash

set -e

# Profile NeoVim startup time
#
# Usage:
#  # uses default nvim config
#  profile-startup-time
#
#  # use a different config:
#  profile-nvim-startup -u ~/path/to/config.file
#
# References:
# https://github.com/mhinz/vim-galore#profiling-startup-time
#
# Options:
#  ... multiple arguments to be passed on to `nvim`.
#

source "$HOME"/dotfiles/bin/__utils/utils.sh

TEMPFILE="$(mktemp).nvim.log"

log_startuptime() {
  nvim --startuptime "${TEMPFILE}" +q
  utils__log__info "written log file into the temp directory: \"${TEMPFILE}\""
}

open_log_file() {
  nvim -u NONE \
    -c "normal G$" \
    -c "colorscheme evening" \
    -c "set mouse=a" \
    -c "set cursorline" \
    "${TEMPFILE}"
}

profile_startup_time() {
  log_startuptime && open_log_file
}

main() {
  profile_startup_time "$@"
}

main "$@"
